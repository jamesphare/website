---
title: "R Notebook"
output: github_document
---

<script src="/rmarkdown-libs/header-attrs/header-attrs.js"></script>


<p><a href="https://github.com/rfordatascience/tidytuesday/blob/master/data/2021/2021-05-25/readme.md" class="uri">https://github.com/rfordatascience/tidytuesday/blob/master/data/2021/2021-05-25/readme.md</a></p>
<pre class="r"><code>library(tidyverse)</code></pre>
<pre><code>## ── Attaching packages ─────────────────────────────────────── tidyverse 1.3.1 ──</code></pre>
<pre><code>## ✓ ggplot2 3.3.3     ✓ purrr   0.3.4
## ✓ tibble  3.1.2     ✓ dplyr   1.0.6
## ✓ tidyr   1.1.3     ✓ stringr 1.4.0
## ✓ readr   1.4.0     ✓ forcats 0.5.1</code></pre>
<pre><code>## ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
## x dplyr::filter() masks stats::filter()
## x dplyr::lag()    masks stats::lag()</code></pre>
<pre class="r"><code>library(lubridate)</code></pre>
<pre><code>## 
## Attaching package: &#39;lubridate&#39;</code></pre>
<pre><code>## The following objects are masked from &#39;package:base&#39;:
## 
##     date, intersect, setdiff, union</code></pre>
<pre class="r"><code>library(ggrepel)
library(extrafont)</code></pre>
<pre><code>## Registering fonts with R</code></pre>
<pre class="r"><code>records &lt;-
        readr::read_csv(
                &#39;https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2021/2021-05-25/records.csv&#39;,
                col_types = cols(
                        track = col_character(),
                        type = col_character(),
                        shortcut = col_character(),
                        player = col_character(),
                        system_played = col_character(),
                        date = col_date(format = &quot;%Y-%m-%d&quot;),
                        time_period = col_character(),
                        time = col_double(),
                        record_duration = col_double()
                )
        )
drivers &lt;-
        readr::read_csv(
                &#39;https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2021/2021-05-25/drivers.csv&#39;,
                col_types = cols(
                        position = col_double(),
                        player = col_character(),
                        total = col_double(),
                        year = col_date(format = &quot;%Y&quot;),
                        records = col_double(),
                        nation = col_character()
                )
        )</code></pre>
<pre class="r"><code>records &lt;- records %&gt;% 
        mutate(shortcut = case_when(shortcut == &quot;Yes&quot; ~ &quot;Shortcut&quot;,
                                    shortcut == &quot;No&quot; ~ &quot;No shortcut&quot;))

drivers &lt;- drivers %&gt;% 
        select(player, nation) %&gt;% 
        distinct()

records &lt;- left_join(records, drivers, by = &quot;player&quot;)

remove(drivers)</code></pre>
<pre class="r"><code>#What is the longest standing world record?

longest_standing &lt;- records %&gt;% 
        group_by(track, type, shortcut) %&gt;% 
        filter(time == min(time)) %&gt;% #choose only current records
        arrange(desc(record_duration)) %&gt;% 
        head(10) %&gt;%
        mutate(&quot;record&quot; = paste(player, track, type, shortcut, system_played, sep = &quot;, &quot;))

ggplot(longest_standing) +
        geom_col(aes(reorder(record, record_duration), record_duration)) + 
        coord_flip()</code></pre>
<p><img src="/post/2021-05-25-mario-kart-64-world-records/notebook_files/figure-html/longest_standing-1.png" width="672" /></p>
<pre class="r"><code>remove(longest_standing)</code></pre>
<pre class="r"><code>#Which track is the fastest
fastest_track &lt;- records %&gt;% 
        group_by(track, type, shortcut) %&gt;%
        summarize(time = min(time))</code></pre>
<pre><code>## `summarise()` has grouped output by &#39;track&#39;, &#39;type&#39;. You can override using the `.groups` argument.</code></pre>
<pre class="r"><code>#Fastest single lap with shortcut
fastest_track %&gt;% 
        filter(shortcut == &quot;Shortcut&quot;,
               type == &quot;Single Lap&quot;) %&gt;% 
ggplot(aes(reorder(track, desc(time)), time)) +
        geom_col() +
        coord_flip()</code></pre>
<p><img src="/post/2021-05-25-mario-kart-64-world-records/notebook_files/figure-html/unnamed-chunk-1-1.png" width="672" /></p>
<pre class="r"><code>#Fastest single lap without shortcut
fastest_track %&gt;% 
        filter(shortcut == &quot;No shortcut&quot;,
               type == &quot;Single Lap&quot;) %&gt;% 
ggplot(aes(reorder(track, desc(time)), time)) +
        geom_col() +
        coord_flip()</code></pre>
<p><img src="/post/2021-05-25-mario-kart-64-world-records/notebook_files/figure-html/unnamed-chunk-2-1.png" width="672" /></p>
<pre class="r"><code>#Fastest race with shortcut
fastest_track %&gt;% 
        filter(shortcut == &quot;Shortcut&quot;,
               type == &quot;Three Lap&quot;) %&gt;% 
ggplot(aes(reorder(track, desc(time)), time)) +
        geom_col() +
        coord_flip()</code></pre>
<p><img src="/post/2021-05-25-mario-kart-64-world-records/notebook_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
<pre class="r"><code>#Fastest race without shortcut
fastest_track %&gt;% 
        filter(shortcut == &quot;No shortcut&quot;,
               type == &quot;Three Lap&quot;) %&gt;% 
ggplot(aes(reorder(track, desc(time)), time)) +
        geom_col() +
        coord_flip()</code></pre>
<p><img src="/post/2021-05-25-mario-kart-64-world-records/notebook_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
<pre class="r"><code>remove(fastest_track)</code></pre>
<pre class="r"><code>#How did the world records develop over time?

#Full race
records %&gt;% 
        filter(type == &quot;Three Lap&quot;) %&gt;% 
ggplot(aes(date, time, color = shortcut)) +
        geom_line() +
        facet_wrap(vars(track), scales = &quot;free_y&quot;)</code></pre>
<p><img src="/post/2021-05-25-mario-kart-64-world-records/notebook_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
<pre class="r"><code>#Single Lap
records %&gt;% 
        filter(type == &quot;Single Lap&quot;) %&gt;% 
ggplot(aes(date, time, color = shortcut)) +
        geom_line() +
        facet_wrap(vars(track), scales = &quot;free_y&quot;)</code></pre>
<p><img src="/post/2021-05-25-mario-kart-64-world-records/notebook_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
<p>So far, I find the development of full-race world records over time to be the most interesting plot. Let’s take some time to improve this plot.</p>
<pre class="r"><code>#choose tracks with interesting shortcuts
interesting_shortcuts &lt;- records %&gt;%
        filter(
                type == &quot;Three Lap&quot;,
                shortcut == &quot;Shortcut&quot;,
                track == &quot;Rainbow Road&quot; |
                        track == &quot;Toad&#39;s Turnpike&quot; |
                        track == &quot;Wario Stadium&quot; |
                        track == &quot;Yoshi Valley&quot;
        )

#create text labels
labels &lt;- interesting_shortcuts %&gt;%
        group_by(track) %&gt;%
        mutate(&quot;improvement&quot; = time - lag(time)) %&gt;%
        slice_min(improvement)

plot_label &lt;- paste(
        sep = &quot;&quot;,
        &quot;Track: &quot;,
        labels$track,
        &quot;\n&quot;,
        &quot;Player: &quot;,
        labels$player,
        &quot;\n&quot;,
        &quot;Date: &quot;,
        format(labels$date, &quot;%B %d, %Y&quot;),
        &quot;\n&quot;,
        &quot;Improvement: &quot;,
        abs(labels$improvement),
        &quot; seconds&quot;
)


ggplot(interesting_shortcuts, aes(date, time, color = track)) +
        geom_line() +
        geom_label_repel(
                aes(label = plot_label, x = date, y = time),
                data = labels,
                seed = 12,
                size = 2,
                min.segment.length = 0,
                show.legend = FALSE,
                force_pull = 0,
                max.overlaps = 4,
                family = &quot;Press Start 2P&quot;
        ) +
        scale_y_continuous() +
        labs(
                title = &quot;On Some Tracks New Shortcuts Yield Massive Improvements&quot;,
                subtitle = &quot;Mario Kart 64 full-race world records over time&quot;,
                y = &quot;Time in Seconds&quot;,
                x = &quot;Date&quot;,
                caption = &quot;jamesphare.org\nSources: Benedikt Claus, Mario Kart World Records&quot;,
                color = &quot;&quot;
        ) +
        theme_minimal() +
        theme(legend.position = &quot;none&quot;,
              text = element_text(family = &quot;Press Start 2P&quot;,
                                  size = 7))</code></pre>
<p><img src="/post/2021-05-25-mario-kart-64-world-records/notebook_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
<pre class="r"><code>ggsave(&quot;mario_kart.png&quot;)</code></pre>
<pre><code>## Saving 7 x 5 in image</code></pre>
